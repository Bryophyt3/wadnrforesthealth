var ProjectFirmaMaps={};ProjectFirmaMaps.Map=function(n,t){var f=this,c,u,i,s;this.MapDivId=n.MapDivID;var l=new L.TileLayer("https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{}),a=new L.TileLayer("https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",{}),v=new L.TileLayer("https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",{}),h=new L.TileLayer("https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}",{}),e={Aerial:l,Street:a,Terrain:v},o={"Street Labels":h},r;for(t==="Hybrid"?(r=new L.LayerGroup,t="Aerial",h.addTo(r)):(Sitka.Methods.isUndefinedNullOrEmpty(t)||e[t]==null)&&(t="Terrain"),c={scrollWheelZoom:!1,layers:[e[t]],attributionControl:!1,fullscreenControl:n.AllowFullScreen?{pseudoFullscreen:!0}:!1},this.map=L.map(this.MapDivId,c),r!=null&&r.addTo(this.map),this.vectorLayers=[],u=0;u<n.Layers.length;++u){i=n.Layers[u];switch(i.LayerType){case"Vector":this.addVectorLayer(i,o);break;case"Wms":this.addWmsLayer(i,o);break;default:console.error("Invalid LayerType "+i.LayerType+" not added to map layers.")}}if(this.addLayersToMapLayersControl(e,o),s=jQuery(".modal"),!Sitka.Methods.isUndefinedNullOrEmpty(s))s.on("shown.bs.modal",function(){f.map.invalidateSize();f.setMapBounds(n)});f.setMapBounds(n)};ProjectFirmaMaps.Map.prototype.addVectorLayer=function(n,t){var i=new L.LayerGroup,r=L.geoJson(n.GeoJsonFeatureCollection,{pointToLayer:function(t,i){var r=t.properties.FeatureColor==null?n.LayerColor:t.properties.FeatureColor;return L.marker(i,{icon:L.MakiMarkers.icon({icon:"marker",color:r,size:"s"})})},style:function(t){var i=_.includes(["Polygon","MultiPolygon"],t.geometry.type);return{color:t.properties.FeatureColor==null?n.LayerColor:t.properties.FeatureColor,weight:t.properties.FeatureWeight==null?2:t.properties.FeatureWeight,fill:t.properties.FillPolygon==null?i:t.properties.FillPolygon,fillOpacity:t.properties.FillOpacity==null?.2:t.properties.FillOpacity}},onEachFeature:function(n,t){self.bindPopupToFeature(t,n)}}).addTo(i);if(n.LayerInitialVisibility===1&&i.addTo(this.map),!n.HasCustomPopups)r.on("click",function(n){self.getFeatureInfo(n)});t[n.LayerName]=i;this.vectorLayers.push(r)};ProjectFirmaMaps.Map.prototype.addWmsLayer=function(n,t){var i=new L.LayerGroup,r=L.Util.extend(this.wmsParams,{layers:n.MapServerLayerName}),u=L.tileLayer.wms(n.MapServerUrl,r).addTo(i);n.LayerInitialVisibility===1&&i.addTo(this.map);t[n.LayerName]=i;this.vectorLayers.push(u)};ProjectFirmaMaps.Map.prototype.wmsParams={service:"WMS",transparent:!0,version:"1.1.1",format:"image/png",info_format:"application/json",tiled:!0};ProjectFirmaMaps.Map.prototype.wfsParams={service:"WFS",version:"2.0",request:"GetFeature",outputFormat:"application/json",SrsName:"EPSG:4326"};ProjectFirmaMaps.Map.prototype.addLayersToMapLayersControl=function(n,t){this.layerControl=L.control.layers(n,t);this.layerControl.addTo(this.map)};ProjectFirmaMaps.Map.prototype.setMapBounds=function(n){this.map.fitBounds([[n.BoundingBox.Northeast.Latitude,n.BoundingBox.Northeast.Longitude],[n.BoundingBox.Southwest.Latitude,n.BoundingBox.Southwest.Longitude]])};ProjectFirmaMaps.Map.prototype.bindPopupToFeature=function(n,t){if(!Sitka.Methods.isUndefinedNullOrEmpty(t.properties.PopupUrl)){n.bindPopup("Loading...",{maxWidth:600});n.on("click",function(){jQuery.get(t.properties.PopupUrl).done(function(t){n.bindPopup(t).openPopup()})})}};ProjectFirmaMaps.Map.prototype.assignClickEventHandler=function(n){for(var r,i=this,t=0;t<this.vectorLayers.length;++t){r=this.vectorLayers[t];r.on("click",function(t){n(i,t)})}this.map.on("click",function(t){n(i,t)})};ProjectFirmaMaps.Map.prototype.removeClickEventHandler=function(){for(var t,n=0;n<this.vectorLayers.length;++n)t=this.vectorLayers[n],t.off("click");this.map.off("click")};ProjectFirmaMaps.Map.prototype.getFeatureInfo=function(n){var i=n.latlng,t='<table class="summaryLayout"><tr><th colspan="2">Location Information<\/th><\/tr>',r,u,f,e,o,s;for(t+=this.formatLayerProperty("Latitude",L.Util.formatNum(i.lat,4)),t+=this.formatLayerProperty("Longitude",L.Util.formatNum(i.lng,4)),r=0;r<this.vectorLayers.length;++r)if(u=this.vectorLayers[r],this.map.hasLayer(u))for(f=leafletPip.pointInLayer(i,u,!0),e=0;e<f.length;++e){o=f[0].feature.properties;for(s in o)t+=this.formatLayerProperty(s,o[s])}(n.layer.feature.geometry.type==="Point"||n.layer.feature.geometry.type==="LineString")&&(t+=this.formatLayerProperty("Info",n.layer.feature.properties.Info));this.map.openPopup(L.popup().setLatLng(i).setContent(t).openOn(this.map))};ProjectFirmaMaps.Map.prototype.formatLayerProperty=function(n,t){return Sitka.Methods.isUndefinedNullOrEmpty(t)&&(t="&nbsp"),"<tr><td>"+n+":<\/td><td>"+t+"<\/td><\/tr>"};ProjectFirmaMaps.Map.prototype.removeLayerFromMap=function(n){Sitka.Methods.isUndefinedNullOrEmpty(n)||this.map.removeLayer(n)};ProjectFirmaMaps.Map.prototype.addLayerToLayerControl=function(n,t){this.layerControl.addOverlay(n,t)};ProjectFirmaMaps.Map.prototype.disableUserInteraction=function(){this.map.dragging.disable();this.map.touchZoom.disable();this.map.doubleClickZoom.disable();this.map.scrollWheelZoom.disable();this.map.boxZoom.disable();this.map.keyboard.disable();this.map.attributionControl=!1;this.map.tap&&this.map.tap.disable();document.getElementById(this.MapDivId).style.cursor="default";jQuery(".leaflet-control-zoom").css("visibility","hidden");jQuery(".leaflet-control-layers").css("visibility","hidden");this.removeClickEventHandler()};ProjectFirmaMaps.Map.prototype.blockMapImpl=function(){this.map.dragging.disable();this.map.scrollWheelZoom.disable();jQuery("#"+this.MapDivId).block({message:"<span style='font-weight: bold; font-size: 14px; margin: 0 2px'>Location Not Specified<\/span>",css:{border:"none",cursor:"default"},overlayCSS:{backgroundColor:"#D3D3D3",cursor:"default"},baseZ:999})};ProjectFirmaMaps.Map.prototype.blockMap=function(){var t=this,n;this.blockMapImpl();n=jQuery(".modal");n.on("shown.bs.modal",function(){t.blockMapImpl()})};ProjectFirmaMaps.Map.prototype.unblockMap=function(){this.map.dragging.enable();jQuery("#"+this.MapDivId).unblock()};