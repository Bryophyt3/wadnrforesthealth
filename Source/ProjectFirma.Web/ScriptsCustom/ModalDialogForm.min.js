/*-----------------------------------------------------------------------
<copyright file="ModalDialogForm.min.js" company="Tahoe Regional Planning Agency">
Copyright (c) Tahoe Regional Planning Agency. All rights reserved.
<author>Sitka Technology Group</author>
</copyright>

<license>
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License <http://www.gnu.org/licenses/> for more details.

Source code is available upon request via <support@sitkatech.com>.
</license>
-----------------------------------------------------------------------*/
function modalDialogLink(n,t,i){var e=jQuery(n),f=Math.floor(Math.random()*1e7),o="SitkajQueryModalDialogUniqueID"+f,s="SitkajQueryModalDialogContentUniqueID"+f,r,u;return r=typeof i=="function"?i():i,u={type:"GET",url:n.href},r!=null&&(u={type:"POST",url:n.href,data:JSON.stringify(r),contentType:"application/json"}),SitkaAjax.ajax(u,function(n){createBootstrapDialogForm(e,o,s,t,n)}),!1}function findBootstrapDialogForm(n,t){var i;if(Sitka.Methods.isUndefinedNullOrEmpty(n)||(i=jQuery("#"+n,t)),Sitka.Methods.isUndefinedNullOrEmpty(i)&&(i=jQuery("form",t)),i.length>1)throw new Error("Found more than 1 form to post!  Cannot proceed.");return i}function createBootstrapDialogForm(n,t,i,r,u){var l=n.attr("data-dialog-title"),o=t+"LoadingDiv",a=jQuery(window).width(),e=parseInt(n.attr("data-dialog-width")),c;a<=800&&(e=0);e=e==0?"auto":e+"px";var s=n.attr("data-save-button-id"),v=n.attr("data-save-button-text"),y=n.attr("data-cancel-button-id"),p=n.attr("data-cancel-button-text"),h=n.attr("data-optional-dialog-form-id"),w=n.attr("data-button-css-classes"),f=jQuery(getModalDialogFromHtmlTemplate(t,l,u,e,v,s,p,y,w,o));f.modal({backdrop:"static"});f.draggable({handle:".modal-header"});c=jQuery("#"+s);c.click(function(){var n=findBootstrapDialogForm(h,f);return n.valid()?(n.submit(),!0):!1});f.on("hide.bs.modal",function(){jQuery("*",f).qtip("hide")});f.on("hidden.bs.modal",function(){jQuery("#"+t).remove()});wireUpModalDialogForm(f,o,r,h)}function wireUpModalDialogForm(n,t,i,r){jQuery.validator.unobtrusive.parse(n);convertJQueryValidationErrorsToQtip();Sitka.Methods.isUndefinedNullOrEmpty(i)||i();jQuery(".sitkaDatePicker").datepicker();var u=findBootstrapDialogForm(r,n);u.ajaxForm({url:this.action,type:this.method,beforeSubmit:function(){jQuery(".progress-bar").html("Saving");jQuery(".progress").show()},success:function(u,f,e){SitkaAjax.handleLoginRedirect(u,f,e,function(){jQuery(".progress").hide();Sitka.Methods.isUndefinedNullOrEmpty(u)||Sitka.Methods.isUndefinedNullOrEmpty(u.Success)||!u.Success?(n.find(".modal-body").html(u),wireUpModalDialogForm(n,t,i,r)):(n.modal("hide"),Sitka.Methods.isUndefinedNullOrEmpty(u.RedirectUrl)?window.location.reload():window.location.href=u.RedirectUrl)})},error:function(t,i){jQuery(".progress").hide();n.modal("hide");SitkaAjax.errorHandler(t,i)}})}function getModalDialogFromHtmlTemplate(n,t,i,r,u,f,e,o,s){var h=i.indexOf("requiredFieldIcon")!==-1,c=h?'<span><sup><span class="glyphicon glyphicon-flash" style="color: #800020; font-size: 8px; "><\/span><\/sup> Required Field<\/span>':"";return"<div class='modal firma-modal' id='"+n+"' tabindex='-1'><div class='modal-dialog firma-modal-dialog' style = 'width: "+r+"'><div class='modal-content'><div class='modal-header'><button type='button' class='modal-close-button btn "+s+"' data-dismiss='modal'><span>&times;<\/span><\/button><span class='modal-title'>"+t+"<\/span><\/div><div class='modal-body'>"+i+"<\/div><div class='modal-footer'>"+c+"<div class='modal-footer-buttons'><button type='button' id='"+f+"' class='btn "+s+"'>"+u+"<\/button><button type='button' id='"+o+"' class='btn "+s+"' data-dismiss='modal'>"+e+"<\/button><\/div><\/div><div class='progress' style='display:none'><div class='progress-bar progress-bar-info progress-bar-striped active' role='progressbar' style='width:100%'>Saving<\/div><\/div><\/div><\/div><\/div>"}
//# sourceMappingURL=ModalDialogForm.min.js.map
