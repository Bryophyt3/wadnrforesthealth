@using ProjectFirma.Web.Views
@using ProjectFirma.Web.Views.Shared
@using LtInfo.Common
@using LtInfo.Common.DhtmlWrappers
@inherits ProjectFirma.Web.Views.FieldDefinition.Index
@section JavascriptAndStylesContent
{
    @{ DhtmlxGridIncludes.RenderPartialView(Html); }
}

<p>
    Use this page to update the definitions for fields used in this system. These definitions provide guidance or help to users who are viewing or editing information in this system. These definitions are visible to users when viewing a page or editor that lists these fields (e.g. the summary page for a project, and its popup editors); if a field has no definition, the "?" (Help) icon will be displayed in gray.
</p>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-7">
            @Html.DhtmlxGrid(ViewDataTyped.GridSpec, ViewDataTyped.GridName, ViewDataTyped.GridDataUrl, "", DhtmlxGridResizeType.VerticalFillHorizontalAutoFit)
        </div>
        <div class="col-md-5">
            <h2 style="margin-top: 0">Definition</h2>
            <div id="fieldDefinition" style="outline: 1px solid gray; padding: 10px; margin-top: 10px"></div>
        </div>
    </div>
</div>

<script type="text/javascript">
    // <![CDATA[
    jQuery(document).ready(function()
    {
        var sitkaGrid = Sitka.@ViewDataTyped.GridName;
        sitkaGrid.grid.attachEvent("onRowSelect", function(id)
        {
            var fieldDefinitionId = sitkaGrid.grid.cells(id, sitkaGrid.getColumnIndexByName("FieldDefinitionID")).getValue();
            var dataUrlTemplate = new Sitka.UrlTemplate(@Html.Raw(ViewDataTyped.FieldDefinitionDataUrl.ToJS()));
            var dataUrl = dataUrlTemplate.ParameterReplace(fieldDefinitionId);
            SitkaAjax.load(jQuery("#fieldDefinition"), dataUrl);
        });
        sitkaGrid.grid.attachEvent("onXLE", function() { sitkaGrid.grid.selectRow(0, true); });
        sitkaGrid.grid.attachEvent("onFilterEnd", function() { sitkaGrid.grid.selectRow(0, true); });
    });
    // ]]>
</script>