@using ProjectFirma.Web.Models
@using ProjectFirma.Web.Views
@using ProjectFirma.Web.Views.Shared
@using LtInfo.Common
@using LtInfo.Common.BootstrapWrappers
@using LtInfo.Common.DhtmlWrappers
@using LtInfo.Common.ModalDialog
@inherits ProjectFirma.Web.Views.User.Summary

@section JavascriptAndStylesContent
{
    @{ DhtmlxGridIncludes.RenderPartialView(Html); }
    <script src="@Url.Content("~/Views/PersonOrganization/PersonOrganizationController.js")" type="text/javascript"></script>

    <style type="text/css">
        .paddedTableCell {
            padding-left: 8px;
            padding-right: 8px;
            padding-bottom: 3px;
        }
    </style>

}

@section RightOfPageTitle
{
    @if (ViewDataTyped.UserHasPersonManagePermissions)
    {
        @ModalDialogFormHelper.ModalDialogFormLink(string.Format("{0}{1} User", "<span class='glyphicon glyphicon-edit blue' style='margin-right:3px'></span>", ViewDataTyped.Person.IsActive ? "Inactivate" : "Activate"), ViewDataTyped.ActivateInactivateUrl, string.Format("{0} this user?", ViewDataTyped.Person.IsActive ? "Inactivate" : "Activate"), 400, "Continue", "Cancel", null, null, null)
    }
}

<div class="row">
    <div class="col-md-6">
        <div class="summarySection">
            <h2>Basics</h2>
            <div class="contentWrapper">
                <table class="summaryLayout">
                    <tr>
                        <th>Name:</th>
                        <td>
                            @ViewDataTyped.Person.FullNameFirstLast
                        </td>
                    </tr>
                    <tr>
                        <th>Email:</th>
                        <td>
                            @ViewDataTyped.Person.Email
                        </td>
                    </tr>
                    <tr>
                        <th>Phone:</th>
                        <td>
                            @ViewDataTyped.Person.Phone.ToPhoneNumberString()
                        </td>
                    </tr>
                    <tr>
                        <th>Organization:</th>
                        <td>
                            @ViewDataTyped.Person.Organization.GetDisplayNameAsUrl()
                        </td>
                    </tr>


                    @if (ViewDataTyped.UserHasPersonManagePermissions)
                    {
                        <tr><td>&nbsp;</td></tr>
                        <tr>
                            <th>Last Activity:</th>
                            <td>
                                @ViewDataTyped.Person.LastActivityDate.ToStringDateTimeNoLeadingZeros()
                            </td>
                        </tr>
                        <tr>
                            <th>Created Date:</th>
                            <td>
                                @ViewDataTyped.Person.CreateDate.ToStringDateTimeNoLeadingZeros()
                            </td>
                        </tr>
                    }
                </table>
                @if (ViewDataTyped.UserHasPersonManagePermissions || ViewDataTyped.IsViewingSelf)
                {
                    <div class="systemText" style="margin-top: 7px">
                        This information can be
                        <a target="_blank" href="@ViewDataTyped.Person.GetKeystoneEditLink()">edited here</a>
                    </div>
                }
            </div>
        </div>
    </div>
    @if (ViewDataTyped.UserHasPersonManagePermissions || ViewDataTyped.IsViewingSelf)
    {
        <div class="col-md-6">
            <div class="summarySection">
                <h2>@ViewDataTyped.EditRolesLink Roles</h2>
                <div class="contentWrapper">
                    <table>
                        <tr>
                            <th style="padding-bottom: 10px;" class="paddedTableCell">Role</th>
                            <th style="padding-bottom: 10px;" class="paddedTableCell">Receive Support Emails</th>
                        </tr>
                        <tr>
                            <td class="paddedTableCell">
                                @if (ViewDataTyped.UserHasPersonManagePermissions)
                                {
                                    @ViewDataTyped.Person.EIPRole.GetDisplayNameAsUrl()
                                }
                                else
                                {
                                    @ViewDataTyped.Person.EIPRole.RoleDisplayName
                                }
                            </td>
                            <td class="paddedTableCell" style="text-align: center">
                                @ViewDataTyped.Person.ReceiveSupportEmails.ToYesNo()
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    }
</div>

<div class="summarySection">
    <h2>@ModalDialogFormHelper.MakeEditIconLink(ViewDataTyped.EditPersonOrganizationPrimaryContactUrl, string.Format("Edit Organizations for which {0} is a Primary Contact", ViewDataTyped.Person.FullNameFirstLast), ViewDataTyped.UserHasPersonManagePermissions) @string.Format("Organizations for which {0} is a Primary Contact", ViewDataTyped.Person.FullNameFirstLast)</h2>
    <div class="contentWrapper">
        @if (ViewDataTyped.Person.PrimaryContactOrganizations.Any())
        {
            <ul style="margin: 5px 0">
                @foreach (var organization in ViewDataTyped.Person.PrimaryContactOrganizations)
                {
                    <li>@organization.GetDisplayNameAsUrl()</li>
                }
            </ul>
        }
    </div>
</div>


<div class="summarySection">
    <h2>@string.Format("EIP Projects for which {0} is a Primary Contact", ViewDataTyped.Person.FullNameFirstLast)</h2>
    <div class="contentWrapper">
        @Html.DhtmlxGrid(ViewDataTyped.BasicProjectInfoGridSpec, ViewDataTyped.BasicProjectInfoGridName, ViewDataTyped.BasicProjectInfoGridDataUrl, "height:300px", DhtmlxGridResizeType.VerticalResizableHorizontalAutoFit)
    </div>
</div>

<div class="summarySection">
    <h2>System Communications</h2>
    <div class="contentWrapper">
        @Html.DhtmlxGrid(ViewDataTyped.UserNotificationGridSpec, ViewDataTyped.UserNotificationGridName, ViewDataTyped.UserNotificationGridDataUrl, "height:300px", DhtmlxGridResizeType.VerticalResizableHorizontalAutoFit)
    </div>
</div>

@if (ViewDataTyped.UserHasPersonViewPermissions)
{
    <div style="margin-top: 20px">
        <a class="btn btn-blue" href="@ViewDataTyped.Index">@BootstrapHtmlHelpers.MakeGlyphIcon("glyphicon-chevron-left") Index</a>
    </div>
}